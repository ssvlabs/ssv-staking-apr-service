
services:
  postgres:
    image: postgres:16-alpine
    container_name: ssv-apr-postgres
    restart: always
    environment:
      POSTGRES_DB: ssv_apr
      POSTGRES_USER: ssv_user
      POSTGRES_PASSWORD: ssv_password
    ports:
      - '5433:5432'
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U ssv_user -d ssv_apr']
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ssv-network

  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ssv-apr-api
    restart: always
    environment:
      DATABASE_HOST: postgres
      DATABASE_PORT: 5432
      DATABASE_USER: ssv_user
      DATABASE_PASSWORD: ssv_password
      DATABASE_NAME: ssv_apr
      ORACLE_URL: ${ORACLE_URL:-}
      RPC_URL: ${RPC_URL:-http://hoodi-execution-lb.stage.ops.ssvlabsinternal.com:32000}
      EXPLORER_CENTER_HOODI: http://localhost:8080/api/v4/hoodi
      VIEWS_CONTRACT_ADDRESS: ${VIEWS_CONTRACT_ADDRESS:-0x02e67E48e64ad381C386cdB59295aD2B79675F25}
      STAKING_CONTRACT_ADDRESS: ${STAKING_CONTRACT_ADDRESS:-0xdf4f52446DA26D29f10acafb8F1C4F658A0C92b5}
      COINGECKO_API_URL: https://api.coingecko.com/api/v3
      APR_CALCULATION_CRON: ${APR_CALCULATION_CRON:-0 0 * * *}
      PORT: 3000
      NODE_ENV: development
    ports:
      - '3000:3000'
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - ssv-network

networks:
  ssv-network:
    driver: bridge

volumes:
  postgres_data:
